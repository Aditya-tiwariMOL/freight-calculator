<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Freight Calculator</title>

<style>
*,
*::before,
*::after { box-sizing: border-box; }

body {
  margin:0;
  font-family:Arial, sans-serif;
  background:#f4f4f4;
  padding:20px;
}

.card {
  background:white;
  max-width:900px;
  margin:0 auto;
  padding:20px;
  border-radius:14px;
  box-shadow:0 4px 20px rgba(0,0,0,0.12);
}

.logo-text {
  text-align:center;
  font-size:19px; /* +1px */
  font-weight:900;
  color:#164A9D;
}

h2 {
  text-align:center;
  font-size:21px; /* +1px */
  margin:10px 0 20px;
}

.input-box {
  background:#fafafa;
  border-radius:12px;
  padding:15px;
  max-width:450px;
  margin:0 auto;
}

label {
  margin-top:15px;
  font-weight:bold;
  font-size:16px; /* +1px */
  display:block;
}

input, select {
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px; /* +1px */
}

.suggestion-box {
  display:none;
  position:absolute;
  background:white;
  border:1px solid #ccc;
  border-radius:8px;
  width:100%;
  max-height:180px;
  overflow-y:auto;
  z-index:100;
}

.suggestion-box div {
  padding:10px;
  cursor:pointer;
}
.suggestion-box div:hover {
  background:#eaf4ff;
}

.loader {
  display:none;
  justify-content:center;
  margin-top:25px;
}
.loader::after {
  content:"";
  width:50px;
  height:50px;
  border:6px solid #e3e3e3;
  border-top-color:#1E74F0;
  border-radius:50%;
  animation:spin 0.9s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.result-wrapper {
  display:none;
  margin-top:25px;
  background:#f7fbff;
  padding:15px;
  border-radius:12px;
}

.table-wrapper {
  width:100%;
  overflow-x:auto;
}

table {
  width:100%;
  border-collapse:collapse;
  min-width:900px;
}

th, td {
  padding:10px;
  border-bottom:1px solid #e2ecff;
  text-align:left;
}

th {
  background:#1E74F0;
  color:white;
}

td:nth-child(6) { font-weight:bold; }
</style>
</head>

<body>
<div class="card">

  <div style="text-align:center; margin-bottom:10px;">
    <img src="https://raw.githubusercontent.com/Aditya-tiwariMOL/freight-calculator/main/MOL%20Logo%2001.png"
         style="height:35px; margin-bottom:5px;">
    <div class="logo-text">MOL Logistics (INDIA) PVT. LTD.</div>
  </div>

  <h2>Freight Calculator</h2>

  <div class="input-box">

    <label>POL</label>
    <div style="position:relative;">
      <input id="polInput" placeholder="Type POL...">
      <div id="polList" class="suggestion-box"></div>
    </div>

    <label>POD</label>
    <div style="position:relative;">
      <input id="podInput" placeholder="Type POD...">
      <div id="podList" class="suggestion-box"></div>
    </div>

    <label>Container</label>
    <select id="container">
      <option value="">Select Container</option>
      <option>20GP</option>
      <option>40GP</option>
      <option>40GP/HC</option>
    </select>

  </div>

  <div class="loader" id="loader"></div>

  <div class="result-wrapper" id="resultBox">
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Line</th><th>Freight</th><th>BAF</th><th>Sur.</th>
            <th>Local</th><th>Total</th><th>Remark</th>
            <th>Route</th><th>Validity</th>
          </tr>
        </thead>
        <tbody id="resultBody"></tbody>
      </table>
    </div>
  </div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxvRp16ShsJ0CHyzVC7TnuensTPsZSaXq4cbbqIfSeYx2xCNkNh4LDYrTf8BTR5x1Cq/exec";

const polInput = document.getElementById("polInput");
const podInput = document.getElementById("podInput");
const container = document.getElementById("container");
const polList = document.getElementById("polList");
const podList = document.getElementById("podList");
const loader = document.getElementById("loader");
const resultBox = document.getElementById("resultBox");
const resultBody = document.getElementById("resultBody");

let suppressSuggestions = false;

function normalize(s) {
  return s.toLowerCase().replace(/\s+/g,"");
}

function smartFilter(items, query) {
  const q = normalize(query);
  if (!q) return items;
  return items.filter(it => {
    const n = normalize(it);
    return n.includes(q) || n.startsWith(q.slice(0,3));
  });
}

function setupTypeAhead(input, box, items) {
  input.oninput = () => {
    if (suppressSuggestions) return;
    const list = smartFilter(items, input.value);
    if (!list.length) return box.style.display="none";
    box.innerHTML = list.map(x=>`<div>${x}</div>`).join("");
    box.style.display="block";
    box.querySelectorAll("div").forEach(d=>{
      d.onmousedown = ()=>{
        suppressSuggestions = true;
        input.value = d.textContent;
        box.style.display="none";
        setTimeout(()=>suppressSuggestions=false,100);
        input.dispatchEvent(new Event("change"));
      };
    });
  };
  input.onblur = ()=>setTimeout(()=>box.style.display="none",150);
}

(async()=>{
  const pols = await fetch(API_URL+"?action=pol").then(r=>r.json());
  setupTypeAhead(polInput, polList, pols);
})();

polInput.onchange = async ()=>{
  podInput.value="";
  container.value="";
  resultBox.style.display="none";
  const pods = await fetch(API_URL+"?action=pod&pol="+encodeURIComponent(polInput.value)).then(r=>r.json());
  setupTypeAhead(podInput, podList, pods);
};

container.onchange = async ()=>{
  if (!container.value) return;
  loader.style.display="flex";
  resultBox.style.display="none";
  const rows = await fetch(API_URL+"?action=rates&pol="+encodeURIComponent(polInput.value)+"&pod="+encodeURIComponent(podInput.value)+"&container="+encodeURIComponent(container.value)).then(r=>r.json());
  loader.style.display="none";
  if (!rows.length) return;
  resultBody.innerHTML = rows.map(r=>`
    <tr>
      <td>${r.carrier}</td><td>${r.freight}</td><td>${r.obs}</td>
      <td>${r.surcharges}</td><td>${r.local}</td><td>${r.total}</td>
      <td>${r.remark}</td><td>${r.routing}</td><td>${r.validity}</td>
    </tr>`).join("");
  resultBox.style.display="block";
};
</script>

</body>
</html>
